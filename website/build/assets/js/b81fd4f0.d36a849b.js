"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3934],{3905:(n,e,t)=>{t.d(e,{Zo:()=>d,kt:()=>y});var a=t(7294);function i(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function l(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function r(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?l(Object(t),!0).forEach((function(e){i(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function o(n,e){if(null==n)return{};var t,a,i=function(n,e){if(null==n)return{};var t,a,i={},l=Object.keys(n);for(a=0;a<l.length;a++)t=l[a],e.indexOf(t)>=0||(i[t]=n[t]);return i}(n,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);for(a=0;a<l.length;a++)t=l[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}var u=a.createContext({}),s=function(n){var e=a.useContext(u),t=e;return n&&(t="function"==typeof n?n(e):r(r({},e),n)),t},d=function(n){var e=s(n.components);return a.createElement(u.Provider,{value:e},n.children)},m="mdxType",p={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},c=a.forwardRef((function(n,e){var t=n.components,i=n.mdxType,l=n.originalType,u=n.parentName,d=o(n,["components","mdxType","originalType","parentName"]),m=s(t),c=i,y=m["".concat(u,".").concat(c)]||m[c]||p[c]||l;return t?a.createElement(y,r(r({ref:e},d),{},{components:t})):a.createElement(y,r({ref:e},d))}));function y(n,e){var t=arguments,i=e&&e.mdxType;if("string"==typeof n||i){var l=t.length,r=new Array(l);r[0]=c;var o={};for(var u in e)hasOwnProperty.call(e,u)&&(o[u]=e[u]);o.originalType=n,o[m]="string"==typeof n?n:i,r[1]=o;for(var s=2;s<l;s++)r[s]=t[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},1809:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>u,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>m});var a=t(7462),i=t(3366),l=(t(7294),t(3905)),r=["components"],o={id:"tutorial-unnest-datasource",sidebar_label:"Using the unnest datasource",title:"Tutorial: Unnest data in a column"},u=void 0,s={unversionedId:"tutorials/tutorial-unnest-datasource",id:"tutorials/tutorial-unnest-datasource",title:"Tutorial: Unnest data in a column",description:"\x3c!--",source:"@site/../docs/tutorials/tutorial-unnest-datasource.md",sourceDirName:"tutorials",slug:"/tutorials/tutorial-unnest-datasource",permalink:"/docs/tutorials/tutorial-unnest-datasource",draft:!1,editUrl:"https://github.com/apache/druid/edit/master/docs/../docs/tutorials/tutorial-unnest-datasource.md",tags:[],version:"current",lastUpdatedBy:"317brian",lastUpdatedAt:1673034071,formattedLastUpdatedAt:"Jan 6, 2023",frontMatter:{id:"tutorial-unnest-datasource",sidebar_label:"Using the unnest datasource",title:"Tutorial: Unnest data in a column"},sidebar:"docs",previous:{title:"Get to know Query view",permalink:"/docs/tutorials/tutorial-sql-query-view"},next:{title:"Jupyter Notebook tutorials",permalink:"/docs/tutorials/tutorial-jupyter-index"}},d={},m=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Load data with nested values",id:"load-data-with-nested-values",level:2},{value:"View the data",id:"view-the-data",level:2},{value:"Unnest a single column",id:"unnest-a-single-column",level:2},{value:"Scan query",id:"scan-query",level:3},{value:"groupBy query",id:"groupby-query",level:3},{value:"topN query",id:"topn-query",level:3},{value:"Unnest with a JOIN query",id:"unnest-with-a-join-query",level:3},{value:"Unnest multiple columns",id:"unnest-multiple-columns",level:2},{value:"Load data with two columns of nested values",id:"load-data-with-two-columns-of-nested-values",level:3},{value:"Unnest <code>nested_data2</code>",id:"unnest-nested_data2",level:3},{value:"Unnest inline datasource",id:"unnest-inline-datasource",level:2},{value:"Unnest a virtual column",id:"unnest-a-virtual-column",level:2},{value:"Learn more",id:"learn-more",level:2}],p={toc:m};function c(n){var e=n.components,t=(0,i.Z)(n,r);return(0,l.kt)("wrapper",(0,a.Z)({},p,t,{components:e,mdxType:"MDXLayout"}),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"If you're looking for information about how to unnest ",(0,l.kt)("inlineCode",{parentName:"p"},"COMPLEX<json>")," columns, see ",(0,l.kt)("a",{parentName:"p",href:"/docs/querying/nested-columns"},"Nested columns"),".")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"The unnest datasource is currently only available as part of a native query.")),(0,l.kt)("p",null,"This tutorial demonstrates how to use the unnest datasource to unnest a column that has data stored in arrays. For example, if you have a column named ",(0,l.kt)("inlineCode",{parentName:"p"},"dim3")," with values like ",(0,l.kt)("inlineCode",{parentName:"p"},"[a,b]")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"[c,d,f]"),", the unnest datasource can output the data to a new column with individual rows that contain single values like ",(0,l.kt)("inlineCode",{parentName:"p"},"a")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"b"),". When doing this, be mindful of the following:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Unnesting data can dramatically increase the total number of rows. "),(0,l.kt)("li",{parentName:"ul"},"You cannot unnest an array within an array. ")),(0,l.kt)("p",null,"You can use the Druid console  or API to unnest data. To start though, you may want to use the Druid console so that viewing the nested and unnested data is easier. "),(0,l.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,l.kt)("p",null,"You need a Druid cluster, such as the ",(0,l.kt)("a",{parentName:"p",href:"/docs/tutorials/"},"micro-quickstart"),". The cluster does not need any existing datasources. You'll load a basic one as part of this tutorial."),(0,l.kt)("h2",{id:"load-data-with-nested-values"},"Load data with nested values"),(0,l.kt)("p",null,"The data you're ingesting contains a handful of rows that resemble the following:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"t:2000-01-01, m1:1.0, m2:1.0, dim1:, dim2:[a], dim3:[a,b]\n")),(0,l.kt)("p",null,"The focus of this tutorial is on the nested array of values in ",(0,l.kt)("inlineCode",{parentName:"p"},"dim3"),"."),(0,l.kt)("p",null,"You can load this data by running a query for SQL-based ingestion or submitting a JSON-based ingestion spec. The example loads data into a table named ",(0,l.kt)("inlineCode",{parentName:"p"},"nested_data"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},'REPLACE INTO nested_data OVERWRITE ALL\nSELECT\n  TIME_PARSE("t") as __time,\n  dim1,\n  dim2,\n  dim3,\n  m1,\n  m2\nFROM TABLE(\n    EXTERN(\n    \'{"type":"inline","data":"{\\"t\\":\\"2000-01-01\\",\\"m1\\":\\"1.0\\",\\"m2\\":\\"1.0\\",\\"dim1\\":\\"\\",\\"dim2\\":[\\"a\\"],\\"dim3\\":[\\"a\\",\\"b\\"]},\\n{\\"t\\":\\"2000-01-02\\",\\"m1\\":\\"2.0\\",\\"m2\\":\\"2.0\\",\\"dim1\\":\\"10.1\\",\\"dim2\\":[],\\"dim3\\":[\\"c\\",\\"d\\"]},\\n{\\"t\\":\\"2000-01-03\\",\\"m1\\":\\"3.0\\",\\"m2\\":\\"3.0\\",\\"dim1\\":\\"2\\",\\"dim2\\":[\\"\\"],\\"dim3\\":[\\"e\\",\\"f\\"]},\\n{\\"t\\":\\"2001-01-01\\",\\"m1\\":\\"4.0\\",\\"m2\\":\\"4.0\\",\\"dim1\\":\\"1\\",\\"dim2\\":[\\"a\\"],\\"dim3\\":[\\"g\\",\\"h\\"]},\\n{\\"t\\":\\"2001-01-02\\",\\"m1\\":\\"5.0\\",\\"m2\\":\\"5.0\\",\\"dim1\\":\\"def\\",\\"dim2\\":[\\"abc\\"],\\"dim3\\":[\\"i\\",\\"j\\"]},\\n{\\"t\\":\\"2001-01-03\\",\\"m1\\":\\"6.0\\",\\"m2\\":\\"6.0\\",\\"dim1\\":\\"abc\\",\\"dim2\\":[\\"a\\"],\\"dim3\\":[\\"k\\",\\"l\\"]},\\n{\\"t\\":\\"2001-01-02\\",\\"m1\\":\\"5.0\\",\\"m2\\":\\"5.0\\",\\"dim1\\":\\"def\\",\\"dim2\\":[\\"abc\\"],\\"dim3\\":[\\"m\\",\\"n\\"]}"}\',\n    \'{"type":"json"}\',\n    \'[{"name":"t","type":"string"},{"name":"dim1","type":"string"},{"name":"dim2","type":"string"},{"name":"dim3","type":"string"},{"name":"m1","type":"float"},{"name":"m2","type":"double"}]\'\n  )\n)\nPARTITIONED BY YEAR \n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "type": "index_parallel",\n  "spec": {\n    "ioConfig": {\n      "type": "index_parallel",\n      "inputSource": {\n        "type": "inline",\n        "data": "{\\"t\\":\\"2000-01-01\\",\\"m1\\":\\"1.0\\",\\"m2\\":\\"1.0\\",\\"dim1\\":\\"\\",\\"dim2\\":[\\"a\\"],\\"dim3\\":[\\"a\\",\\"b\\"]},\\n{\\"t\\":\\"2000-01-02\\",\\"m1\\":\\"2.0\\",\\"m2\\":\\"2.0\\",\\"dim1\\":\\"10.1\\",\\"dim2\\":[],\\"dim3\\":[\\"c\\",\\"d\\"]},\\n{\\"t\\":\\"2000-01-03\\",\\"m1\\":\\"3.0\\",\\"m2\\":\\"3.0\\",\\"dim1\\":\\"2\\",\\"dim2\\":[\\"\\"],\\"dim3\\":[\\"e\\",\\"f\\"]},\\n{\\"t\\":\\"2001-01-01\\",\\"m1\\":\\"4.0\\",\\"m2\\":\\"4.0\\",\\"dim1\\":\\"1\\",\\"dim2\\":[\\"a\\"],\\"dim3\\":[\\"g\\",\\"h\\"]},\\n{\\"t\\":\\"2001-01-02\\",\\"m1\\":\\"5.0\\",\\"m2\\":\\"5.0\\",\\"dim1\\":\\"def\\",\\"dim2\\":[\\"abc\\"],\\"dim3\\":[\\"i\\",\\"j\\"]},\\n{\\"t\\":\\"2001-01-03\\",\\"m1\\":\\"6.0\\",\\"m2\\":\\"6.0\\",\\"dim1\\":\\"abc\\",\\"dim2\\":[\\"a\\"],\\"dim3\\":[\\"k\\",\\"l\\"]},\\n{\\"t\\":\\"2001-01-02\\",\\"m1\\":\\"5.0\\",\\"m2\\":\\"5.0\\",\\"dim1\\":\\"def\\",\\"dim2\\":[\\"abc\\"],\\"dim3\\":[\\"m\\",\\"n\\"]}"\n      },\n      "inputFormat": {\n        "type": "json"\n      }\n    },\n    "tuningConfig": {\n      "type": "index_parallel",\n      "partitionsSpec": {\n        "type": "dynamic"\n      }\n    },\n    "dataSchema": {\n      "dataSource": "nested_data",\n      "granularitySpec": {\n        "type": "uniform",\n        "queryGranularity": "NONE",\n        "rollup": false,\n        "segmentGranularity": "YEAR"\n      },\n      "timestampSpec": {\n        "column": "t",\n        "format": "auto"\n      },\n      "dimensionsSpec": {\n        "dimensions": [\n          "dim1",\n          "dim2",\n          "dim3"\n        ]\n      },\n      "metricsSpec": [\n        {\n          "name": "m1",\n          "type": "floatSum",\n          "fieldName": "m1"\n        },\n        {\n          "name": "m2",\n          "type": "doubleSum",\n          "fieldName": "m2"\n        }\n      ]\n    }\n  }\n}\n')),(0,l.kt)("h2",{id:"view-the-data"},"View the data"),(0,l.kt)("p",null,"Now that the data is loaded, run the following query:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM nested_data\n")),(0,l.kt)("p",null,"In the results, notice that the column named ",(0,l.kt)("inlineCode",{parentName:"p"},"dim3")," has nested values like ",(0,l.kt)("inlineCode",{parentName:"p"},'["a","b"]'),".  The example queries that follow unnest ",(0,l.kt)("inlineCode",{parentName:"p"},"dim3"),"  and run queries, such as Scan. "),(0,l.kt)("h2",{id:"unnest-a-single-column"},"Unnest a single column"),(0,l.kt)("p",null,"The following section shows examples of how you can use the unnest datasource in queries. They all use the ",(0,l.kt)("inlineCode",{parentName:"p"},"nested_data")," table you created earlier in the tutorial."),(0,l.kt)("h3",{id:"scan-query"},"Scan query"),(0,l.kt)("p",null,"The following native Scan query returns the rows of the datasource and unnests the values in the ",(0,l.kt)("inlineCode",{parentName:"p"},"dim3")," column by using the ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest")," datasource type:"),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Show the query"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "queryType": "scan",\n  "dataSource": {\n    "type": "unnest",\n    "base": {\n      "type": "table",\n      "name": "nested_data"\n    },\n    "column": "dim3",\n    "outputName": "unnest-dim3",\n    "allowList": []\n  },\n  "intervals": {\n    "type": "intervals",\n    "intervals": [\n      "-146136543-09-08T08:23:32.096Z/146140482-04-24T15:36:27.903Z"\n    ]\n  },\n  "limit": 100,\n  "columns": [\n    "__time",\n    "dim1",\n    "dim2",\n    "dim3",\n    "m1",\n    "m2",\n    "unnest-dim3"\n  ],\n  "legacy": false,\n  "granularity": {\n    "type": "all"\n  },\n  "context": {\n    "debug": true,\n    "useCache": false\n  }\n}\n'))),(0,l.kt)("p",null,"In the results, notice that there are more rows than before and an additional column named ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest-dim3"),". The values of ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest-dim3")," are the same as the ",(0,l.kt)("inlineCode",{parentName:"p"},"dim3")," column except the nested values are no longer nested and are each a separate record."),(0,l.kt)("p",null,"With the ",(0,l.kt)("inlineCode",{parentName:"p"},"dataSource.allowList")," parameter, you can unnest a subset of a column. Set the value of ",(0,l.kt)("inlineCode",{parentName:"p"},"allowList")," to ",(0,l.kt)("inlineCode",{parentName:"p"},'["a","b"]')," and run the query again. Only a subset of rows are returned based on the values you allowed."),(0,l.kt)("p",null,"You can also implement filters. For example, you can add the following to the Scan query to filter results to only rows that have the values ",(0,l.kt)("inlineCode",{parentName:"p"},'"a"')," or ",(0,l.kt)("inlineCode",{parentName:"p"},'"abc"')," in ",(0,l.kt)("inlineCode",{parentName:"p"},'"dim2"'),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'  "filter": {\n    "type": "in",\n    "dimension": "dim2",\n    "values": [\n      "a",\n      "abc",\n      ]\n  },\n')),(0,l.kt)("h3",{id:"groupby-query"},"groupBy query"),(0,l.kt)("p",null,"The following query returns an unnested version of the column ",(0,l.kt)("inlineCode",{parentName:"p"},"dim3")," as the column ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest-dim3")," sorted in descending order."),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Show the query"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "queryType": "groupBy",\n  "dataSource": {\n    "type": "unnest",\n    "base": "nested_data",\n    "column": "dim3",\n    "outputName": "unnest-dim3",\n    "allowList": []\n  },\n  "intervals": ["-146136543-09-08T08:23:32.096Z/146140482-04-24T15:36:27.903Z"],\n  "granularity": "all",\n  "dimensions": [\n    "unnest-dim3"\n  ],\n  "limitSpec": {\n    "type": "default",\n    "columns": [\n      {\n        "dimension": "unnest-dim3",\n        "direction": "descending"\n      }\n    ],\n    "limit": 1001\n  },\n  "context": {\n    "debug": true\n  }\n}\n'))),(0,l.kt)("h3",{id:"topn-query"},"topN query"),(0,l.kt)("p",null,"The example topN query unnests ",(0,l.kt)("inlineCode",{parentName:"p"},"dim3")," into the column ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest-dim3"),". The query uses the unnested column as the dimension for the topN query. The results are outputted to a column named ",(0,l.kt)("inlineCode",{parentName:"p"},"topN-unnest-d3")," and are sorted numerically in ascending order based on the column ",(0,l.kt)("inlineCode",{parentName:"p"},"a0"),", an aggregate value representing the minimum of ",(0,l.kt)("inlineCode",{parentName:"p"},"m1"),"."),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Show the query"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "queryType": "topN",\n  "dataSource": {\n    "type": "unnest",\n    "base": {\n      "type": "table",\n      "name": "nested_data"\n    },\n    "column": "dim3",\n    "outputName": "unnest-dim3",\n    "allowList": null\n  },\n  "dimension": {\n    "type": "default",\n    "dimension": "unnest-dim3",\n    "outputName": "topN-unnest-d3",\n    "outputType": "STRING"\n  },\n  "metric": {\n    "type": "inverted",\n    "metric": {\n      "type": "numeric",\n      "metric": "a0"\n    }\n  },\n  "threshold": 3,\n  "intervals": {\n    "type": "intervals",\n    "intervals": [\n      "-146136543-09-08T08:23:32.096Z/146140482-04-24T15:36:27.903Z"\n    ]\n  },\n  "granularity": {\n    "type": "all"\n  },\n  "aggregations": [\n    {\n      "type": "floatMin",\n      "name": "a0",\n      "fieldName": "m1"\n    }\n  ],\n  "context": {\n    "debug": true\n  }\n}\n'))),(0,l.kt)("h3",{id:"unnest-with-a-join-query"},"Unnest with a JOIN query"),(0,l.kt)("p",null,"This query joins the ",(0,l.kt)("inlineCode",{parentName:"p"},"nested_data")," table with itself and outputs the unnested data into a new column called ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest-dim3"),"."),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Show the query"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "queryType": "scan",\n  "dataSource": {\n    "type": "unnest",\n    "base": {\n        "type": "join",\n        "left": {\n          "type": "table",\n          "name": "nested_data"\n        },\n        "right": {\n          "type": "query",\n          "query": {\n            "queryType": "scan",\n            "dataSource": {\n              "type": "table",\n              "name": "nested_data"\n            },\n            "intervals": {\n              "type": "intervals",\n              "intervals": [\n                "-146136543-09-08T08:23:32.096Z/146140482-04-24T15:36:27.903Z"\n              ]\n            },\n            "virtualColumns": [\n              {\n                "type": "expression",\n                "name": "v0",\n                "expression": "\\"m2\\"",\n                "outputType": "FLOAT"\n              }\n            ],\n            "resultFormat": "compactedList",\n            "columns": [\n              "__time",\n              "dim1",\n              "dim2",\n              "dim3",\n              "m1",\n              "m2",\n              "v0"\n            ],\n            "legacy": false,\n            "context": {\n              "sqlOuterLimit": 1001,\n              "useNativeQueryExplain": true\n            },\n            "granularity": {\n              "type": "all"\n            }\n          }\n        },\n        "rightPrefix": "j0.",\n        "condition": "(\\"m1\\" == \\"j0.v0\\")",\n        "joinType": "INNER"\n      },\n    "column": "dim3",\n    "outputName": "unnest-dim3",\n    "allowList": []\n    },\n  "intervals": {\n    "type": "intervals",\n    "intervals": [\n      "-146136543-09-08T08:23:32.096Z/146140482-04-24T15:36:27.903Z"\n    ]\n  },\n  "resultFormat": "compactedList",\n  "limit": 1001,\n  "columns": [\n    "__time",\n    "dim1",\n    "dim2",\n    "dim3",\n    "j0.__time",\n    "j0.dim1",\n    "j0.dim2",\n    "j0.dim3",\n    "j0.m1",\n    "j0.m2",\n    "m1",\n    "m2",\n    "unnest-dim3"\n  ],\n  "legacy": false,\n  "context": {\n    "sqlOuterLimit": 1001,\n    "useNativeQueryExplain": true\n  },\n  "granularity": {\n    "type": "all"\n  }\n}\n'))),(0,l.kt)("h2",{id:"unnest-multiple-columns"},"Unnest multiple columns"),(0,l.kt)("p",null,"You can use a single unnest datasource to unnest multiple columns. Be careful when doing this though because it can lead to a very large number of new rows."),(0,l.kt)("h3",{id:"load-data-with-two-columns-of-nested-values"},"Load data with two columns of nested values"),(0,l.kt)("p",null,"Ingest this new data into a table called ",(0,l.kt)("inlineCode",{parentName:"p"},"nested_data2"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},'REPLACE INTO "nested_data2" OVERWRITE ALL\nSELECT\n  TIME_PARSE("t") as __time,\n  "dim1",\n  "dim2",\n  "dim3",\n  "m1",\n  "m2"\nFROM TABLE(\n  EXTERN(\n    \'{"type":"inline","data":"{\\"t\\":\\"2000-01-01\\",\\"m1\\":\\"1.0\\",\\"m2\\":\\"1.0\\",\\"dim1\\":\\"\\",\\"dim2\\":[\\"x\\",\\"y\\"],\\"dim3\\":[\\"a\\",\\"b\\"]},\\n{\\"t\\":\\"2000-01-02\\",\\"m1\\":\\"2.0\\",\\"m2\\":\\"2.0\\",\\"dim1\\":\\"10.1\\",\\"dim2\\":[\\"e\\",\\"f\\"],\\"dim3\\":[\\"a\\",\\"b\\",\\"c\\",\\"d\\"]}"}\',\n    \'{"type":"json"}\',\n    \'[{"name":"t","type":"string"},{"name":"dim1","type":"string"},{"name":"dim2","type":"string"},{"name":"dim3","type":"string"},{"name":"m1","type":"float"},{"name":"m2","type":"double"}]\'\n  )\n)\nPARTITIONED BY YEAR\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "type": "index_parallel",\n  "spec": {\n    "ioConfig": {\n      "type": "index_parallel",\n      "inputSource": {\n        "type": "inline",\n        "data": "{\\"t\\":\\"2000-01-01\\",\\"m1\\":\\"1.0\\",\\"m2\\":\\"1.0\\",\\"dim1\\":\\"\\",\\"dim2\\":[\\"x\\",\\"y\\"],\\"dim3\\":[\\"a\\",\\"b\\"]},\\n{\\"t\\":\\"2000-01-02\\",\\"m1\\":\\"2.0\\",\\"m2\\":\\"2.0\\",\\"dim1\\":\\"10.1\\",\\"dim2\\":[\\"e\\",\\"f\\"],\\"dim3\\":[\\"a\\",\\"b\\",\\"c\\",\\"d\\"]}"\n      },\n      "inputFormat": {\n        "type": "json"\n      }\n    },\n    "tuningConfig": {\n      "type": "index_parallel",\n      "partitionsSpec": {\n        "type": "dynamic"\n      }\n    },\n    "dataSchema": {\n      "dataSource": "nested_data2",\n      "granularitySpec": {\n        "type": "uniform",\n        "queryGranularity": "NONE",\n        "rollup": false,\n        "segmentGranularity": "YEAR"\n      },\n      "timestampSpec": {\n        "column": "t",\n        "format": "auto"\n      },\n      "dimensionsSpec": {\n        "dimensions": [\n          "dim1",\n          "dim2",\n          "dim3"\n        ]\n      },\n      "metricsSpec": [\n        {\n          "name": "m1",\n          "type": "floatSum",\n          "fieldName": "m1"\n        },\n        {\n          "name": "m2",\n          "type": "doubleSum",\n          "fieldName": "m2"\n        }\n      ]\n    }\n  }\n}\n')),(0,l.kt)("h3",{id:"unnest-nested_data2"},"Unnest ",(0,l.kt)("inlineCode",{parentName:"h3"},"nested_data2")),(0,l.kt)("p",null,"The following query performs two unnests. It unnests ",(0,l.kt)("inlineCode",{parentName:"p"},"dim3")," into a column named ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest-dim3"),". It also performs an unnest on ",(0,l.kt)("inlineCode",{parentName:"p"},"dim2")," and outputs the results to ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest-dim2"),". You can then treat the combination of ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest-dim3")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest-dim2")," as Cartesian products."),(0,l.kt)("p",null,"When you run the query, pay special attention to how the total number of rows has grown drastically. The source data has 2 rows. The unnested data has 12 rows, (2 x 2) + (2 x 4)."),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Show the query"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "queryType": "scan",\n  "dataSource": {\n    "type": "unnest",\n    "base": {\n      "type": "unnest",\n      "base": {\n        "type": "table",\n        "name": "nested_data2"\n      },\n      "column": "dim3",\n      "outputName": "unnest-dim3",\n      "allowList": []\n    },\n    "column": "dim2",\n    "outputName": "unnest-dim2",\n    "allowList": []\n  },\n  "intervals": {\n    "type": "intervals",\n    "intervals": [\n      "-146136543-09-08T08:23:32.096Z/146140482-04-24T15:36:27.903Z"\n    ]\n  },\n  "limit": 1000,\n  "columns": [\n    "__time",\n    "dim1",\n    "dim2",\n    "dim3",\n    "m1",\n    "m2",\n    "unnest-dim3",\n    "unnest-dim2"\n  ],\n  "legacy": false,\n  "granularity": {\n    "type": "all"\n  },\n  "context": {\n    "debug": true,\n    "useCache": false\n  }\n}\n'))),(0,l.kt)("h2",{id:"unnest-inline-datasource"},"Unnest inline datasource"),(0,l.kt)("p",null,"You can also use the ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest")," datasource to unnest an inline datasource. The following query takes the row ",(0,l.kt)("inlineCode",{parentName:"p"},"[1,2,3]")," in the column ",(0,l.kt)("inlineCode",{parentName:"p"},"inline_data")," that is provided inline within the query and returns it as unnested values in the ",(0,l.kt)("inlineCode",{parentName:"p"},"output")," column:"),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Show the query"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "queryType": "scan",\n  "dataSource": {\n    "type": "unnest",\n    "base": {\n      "type": "inline",\n      "columnNames": [\n        "inline_data"\n      ],\n      "columnTypes": [\n        "long_array"\n      ],\n      "rows": [\n        [\n          [1,2,3]\n        ]\n      ]\n    },\n    "column": "inline_data",\n    "outputName": "output",\n    "allowList": []\n  },\n  "intervals": {\n    "type": "intervals",\n    "intervals": [\n      "-146136543-09-08T08:23:32.096Z/146140482-04-24T15:36:27.903Z"\n    ]\n  },\n  "resultFormat": "compactedList",\n  "limit": 1001,\n  "columns": [\n    "inline_data",\n    "output"\n  ],\n  "legacy": false,\n  "granularity": {\n    "type": "all"\n  }\n}\n'))),(0,l.kt)("h2",{id:"unnest-a-virtual-column"},"Unnest a virtual column"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest")," datasource supports unnesting a virtual columns, which is a queryable composite column that can draw data from multiple source columns."),(0,l.kt)("p",null,"The following Scan query uses the ",(0,l.kt)("inlineCode",{parentName:"p"},"nested_data2")," table you created in ",(0,l.kt)("a",{parentName:"p",href:"#load-data-with-two-columns-of-nested-values"},"Load data with two columns of nested values"),". It returns the columns ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest-v0")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"m1"),". The ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest-v0")," column is the unnested version of the virtual column ",(0,l.kt)("inlineCode",{parentName:"p"},"v0"),", which contains an array of the ",(0,l.kt)("inlineCode",{parentName:"p"},"dim2")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"dim3")," columns."),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Show the query"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "queryType": "scan",\n  "dataSource":{\n    "type": "unnest",\n    "base": {\n      "type": "table",\n      "name": "nested_data2"\n    },\n    "column": "v0",\n    "outputName": "unnest-v0"\n  }\n  "intervals": {\n    "type": "intervals",\n    "intervals": [\n      "-146136543-09-08T08:23:32.096Z/146140482-04-24T15:36:27.903Z"\n    ]\n  },\n  "virtualColumns": [\n    {\n      "type": "expression",\n      "name": "v0",\n      "expression": "array(\\"dim2\\",\\"dim3\\")",\n      "outputType": "ARRAY<STRING>"\n    }\n  ],\n  "resultFormat": "compactedList",\n  "limit": 1001,\n  "columns": [\n    "unnest-v0",\n    "m1"\n  ],\n  "legacy": false,\n  "context": {\n    "populateCache": false,\n    "queryId": "d273facb-08cc-4de7-ac0b-d0b82173e531",\n    "sqlOuterLimit": 1001,\n    "sqlQueryId": "d273facb-08cc-4de7-ac0b-d0b82173e531",\n    "useCache": false,\n    "useNativeQueryExplain": true\n  },\n  "granularity": {\n    "type": "all"\n  }\n}\n'))),(0,l.kt)("h2",{id:"learn-more"},"Learn more"),(0,l.kt)("p",null,"For more information about ",(0,l.kt)("inlineCode",{parentName:"p"},"unnest")," and other datasources, see ",(0,l.kt)("a",{parentName:"p",href:"/docs/querying/datasource#unnest"},"Datasources"),"."))}c.isMDXComponent=!0}}]);